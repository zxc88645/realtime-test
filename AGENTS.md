# 代理程式開發指引

## 語言與溝通
- **始終使用繁體中文回應**
- 所有面向使用者的訊息、註解與文件都使用繁體中文
- 錯誤訊息與主控台記錄提供有意義的中文描述

## 程式碼品質標準
- **保持良好的模組化結構**
- 遵循工廠模式與相依性注入原則
- 使用描述性的函數與變數命名
- 實作適當的錯誤處理與資源清理

## 開發流程
每次完成任務後都必須執行：
1. **測試驗證**：`npm test`
2. **程式碼格式化**：`npm run format`
3. **功能驗證**：確保伺服器正常啟動與 WebSocket/WebRTC 連線正常

## 單元測試撰寫
- **測試描述使用中文**：清楚說明測試情境與預期行為
- **測試結構**：使用 `describe` 區塊組織相關測試案例
- **模擬相依性**：使用 `fetchImpl` 等參數進行獨立測試
- **測試涵蓋範圍**：包含成功與錯誤情境的測試
- **資源清理**：測試後關閉伺服器與連線，處理 `ERR_SERVER_NOT_RUNNING`
- **非同步處理**：適當使用 async/await 模式

## 架構原則
- 使用 Express 工廠模式建立應用程式
- WebSocket 代理模式處理即時通訊
- 集中化配置管理（`src/config/`）
- 事件驅動架構處理客戶端互動

## 安全考量
- 絕不暴露 API 金鑰至客戶端
- 驗證環境變數完整性
- 實作適當的輸入驗證與清理
- 使用短效金鑰進行 WebRTC 驗證
